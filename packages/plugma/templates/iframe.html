<div id="app"></div>
<script type="module">
	const html = document.querySelector('html');

	// Implement own select all

	// Flag to control whether the default action is allowed
	let allowDefault = true;

	// Your custom event listener
	document.addEventListener("keydown", function (event) {
		if ((event.ctrlKey || event.metaKey) && event.key === "a") {
			if (allowDefault) {
				// Custom behavior: Select all text in input/textarea
				const activeElement = document.activeElement;
				if (
					activeElement &&
					(activeElement.tagName === "INPUT" ||
						activeElement.tagName === "TEXTAREA")
				) {
					activeElement.select();
				}
			}
			// Allow or prevent further action based on flag
			if (!allowDefault) {
				event.preventDefault();
				console.log("Custom behavior: prevented default action");
			}
		}

		if (
			(event.metaKey || event.ctrlKey) &&
			event.altKey &&
			(event.key === "Ï€" || event.key === "p")
		) {
			parent.postMessage("$INTERNAL_DO_NOT_USE$RERUN_PLUGIN$", "*");

			// Allow or prevent further action based on flag
			if (!allowDefault) {
				event.preventDefault();
				console.log("Custom behavior: prevented default action");
			}
		}
	});

	// TODO: Think of a way that this can be exposed to consumers
	// Function to control whether the default action should be allowed
	function setAllowDefault(flag) {
		allowDefault = flag;
	}

	// Example: User wants to override the default behavior
	setAllowDefault(false);


	// // Listen for STUFF FROM FIGMA
	window.addEventListener('message', (event) => {
		const message = event.data.pluginMessage;

		if (message.type === "FIGMA_HTML_CLASSES") {
			html.className = message.data
		}
		if (message.type === "FIGMA_STYLES") {
			const styleSheet = document.createElement("style");
			styleSheet.type = "text/css";
			styleSheet.innerText = message.data;

			// Append the style tag to the head
			document.head.appendChild(styleSheet);
		}
	});

</script>
<script type="module" id="entry" src="<%- input %>"></script>
